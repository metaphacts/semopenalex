<style>
  .soa {
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .soa .header {
    padding-bottom: 1rem;
  }
  .soa .row {
    margin-left: 0;
    margin-right: 0;
  }
  .cards {
    display: grid;
    grid-template-columns: 2fr 2fr;
    gap: 1rem;
  }
  .card.publication-chart {
    display: flex;
    flex-direction: row;
    gap: 1rem;
    align-items: center;
  }
  .publication-chart > div:first-child {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    justify-content: center;
  }
  .thumbnail {
    max-height: 200px;
    object-fit: contain;
  }
  .search-concepts {
    background: linear-gradient(180deg, #F4F9FF 2.08%, #FFFFFF 50%);
    border-radius: 8px;
    min-height: 300px;
    display: grid;
    grid-template-columns: minmax(15%, auto) minmax(15%, 0.1fr) auto minmax(15%, 0.1fr) minmax(15%, auto);
    gap: 1rem;
    padding: 2rem 2rem 1rem 2rem;
  }
  .search-concepts > div {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    gap: 0.5rem;
  }
  .search-concepts > div.currentConcept {
    justify-content: center;
    align-items: center;
    padding: 0 2rem;
  }
  .search-concepts img {
    border-radius: 50%;
    width: 50px;
    height: 50px;
    object-fit: fill;
  }
  .related-concepts {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding-bottom: 1rem;
  }
  .related-concepts > div {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  thead {
    display: none;
  }
  .soa .table {
    border: none;
    font-size: 1rem;
  }
  .soa .table tr:not(:first-child) td {
    border-top: none;
  }
  .soa .table td {
    height: auto;
    padding: 0.5rem 0;
  }
  .soa .search-concepts .DataTable--table-grid-layout {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  .soa .search-concepts .broad .DataTable--table-grid-layout, 
  .soa .search-concepts .broader .DataTable--table-grid-layout,
  .soa .search-concepts .broad,
  .soa .search-concepts .broader {
    align-items: flex-end;
  }
  .search-concepts .card__title {
    padding-bottom: 0;
  }
  .search-concepts .DataTable--header-container {
    padding-top: 0;
  }
  .search-concepts .DataTable--footer {
    margin-top: 1.2rem;
  }
  .search-concepts .page-item .page-link {
    background: transparent;
    border: 1px solid #F3F1EE;
  }
  .search-concepts .page-item.active .page-link {
    color: #9F9F9F;
  }
  .concept {
    color: var(--soa-color-blue);
    cursor: pointer;
    padding: 2px 6px;
    font-size: 1.2rem;
  }
  .concept.selected {
    background: #ECF0F6;
    border-radius: 0.5rem;
  }
  .narrower .concept, .broader .concept {
    cursor: initial;
  }
  .narrower, .broader {
    padding-top: 5.6rem;
  }
  .warning {
    display: flex;
    background: rgba(1, 1, 1, 0.05);
    padding: 0.5rem;
    border-radius: 0.5rem;
    text-align: center;
    justify-content: center;
    font-size: 1rem;
    color: var(--soa-color-brown-darker);
  }
  .top-authors ul {
    padding: 0;
    list-style: none;
  }
  .top-authors li {
    display: flex;
    align-items: center;
    gap: 0.8rem;
  }
  .co-author__icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTYgNkM3LjY1NzUgNiA5IDQuNjU3NSA5IDNDOSAxLjM0MjUgNy42NTc1IDAgNiAwQzQuMzQyNSAwIDMgMS4zNDI1IDMgM0MzIDQuNjU3NSA0LjM0MjUgNiA2IDZaTTYgNy41QzMuOTk3NSA3LjUgMCA4LjUwNSAwIDEwLjVWMTEuMjVDMCAxMS42NjI1IDAuMzM3NSAxMiAwLjc1IDEySDExLjI1QzExLjY2MjUgMTIgMTIgMTEuNjYyNSAxMiAxMS4yNVYxMC41QzEyIDguNTA1IDguMDAyNSA3LjUgNiA3LjVaIiBmaWxsPSIjMjA1QkFDIi8+Cjwvc3ZnPgo=);
    background-repeat: no-repeat no-repeat;
    background-position: center center;
    background-size: cover;
    width: 12px;
    height: 12px;
  }
  .publications__label, .citations__label {
    font-size: 1.3rem;
  }
  .publications__value, .citations__value {
    font-size: 3.2rem;
    font-weight: 700;
  }
  .publications__label, .publications__value {
    color: #000000;
  }
  .citations__label, .citations__value {
    color: var(--soa-color-green);
  }
</style>
<div class="soa">
  <div class="header">
    <mp-label iri='{{page-resource}}' class="header__title-main"></mp-label>
  </div>
  <div class="row cards">
    <div class="card publication-chart">
      <div>
        <div>
          <div class="publications__label">Publications</div>
          <semantic-query query='
            SELECT ?count WHERE {
              <{{page-resource}}> <https://semopenalex.org/property/worksCount> ?count
            }' template='{{>tmp}}'>
            <template id="tmp">
              {{#each bindings}}
                <div class="publications__value">{{count.value}}</div>
              {{/each}}
            </template>
          </semantic-query>
        </div>
        <div>
          <div class="citations__label">Citation</div>
          <semantic-query query='
            SELECT ?count WHERE {
              <{{page-resource}}> <https://semopenalex.org/property/citedByCount> ?count  
            }
          ' template="{{> tmp}}">
            <template id="tmp">
              {{#each bindings}}
                <div class="citations__value">{{count.value}}</div>
              {{/each}}
            </template>
          </semantic-query>
        </div>
      </div>
      <semantic-chart type="bar" query="
        SELECT ?year ?work WHERE {
          <{{page-resource}}> <https://semopenalex.org/property/countsByYear> ?count .
          ?count <https://semopenalex.org/property/year> ?year .
          ?count <https://semopenalex.org/property/worksCount> ?work .
        } ORDER BY ASC(?year)
      " sets='[{"dataSetName": "Publications", "category": "year", "x": "year", "y": "work"}]'
        styles='[{
          "provider": "highcharts",
          "style": {
            "series": [
              {"type": "column", "showInLegend": false}
            ]
          }
        }]'
        style-highcharts='{
          "legend": "hide", 
          "caption": {"align": "center", "text": "The last 10 years of publications."}
        }'
        dimensions='{"height": 180}'
      >
      </semantic-chart>
    </div>
    <div class="card">
      <mp-resource-thumbnail iri="{{page-resource}}" class='thumbnail'></mp-resource-thumbnail>
    </div>
  </div>
  <div class="row search-concepts">
    <mp-event-target-template-render id="broaderConcepts" template='{{>tmp}}'>
      <template id="tmp">
        <div class="broader">
          {{#if selectedConcept}}
            <semantic-table query='
              PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
              SELECT DISTINCT ?name WHERE {
                <{{selectedConcept}}> skos:broader|^skos:narrower ?concept .
                ?concept <http://www.w3.org/2004/02/skos/core#prefLabel> ?name .
              }' 
              number-of-displayed-rows="10"
              options='{"showFilter":false}'
              tuple-template='{{> tmp}}'
            >
              <template id="tmp">
                <div class="concept">{{name.value}}</div>
              </template>
            </semantic-table>
          {{/if}}
        </div>
        <div class="broad">
          <div class="card__title">BROADER CONCEPTS</div>
          <semantic-table query='
            PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
            SELECT DISTINCT * WHERE {
              <{{page-resource}}> skos:broader|^skos:narrower ?concept .
              ?concept <http://www.w3.org/2004/02/skos/core#prefLabel> ?name .
            }' 
            number-of-displayed-rows="10"
            tuple-template='{{> tmp}}'
            no-result-template='No broader concepts.'
          >
            <template id="tmp">
              <mp-event-trigger type='Component.TemplateUpdate' data='{"selectedConcept": "{{concept.value}}"}' targets='["broaderConcepts"]'>
                <div class='concept {{# ifCond selectedConcept "===" concept.value }}selected{{/ifCond}}'>{{name.value}}</div>
              </mp-event-trigger>
            </template>
          </semantic-table>
        </div>
      </template>
    </mp-event-target-template-render>
    <div class="currentConcept">
      <mp-resource-thumbnail iri="{{page-resource}}" class='thumbnail'></mp-resource-thumbnail>
      <mp-label iri='{{page-resource}}' class="card__title"></mp-label>
    </div>
      <mp-event-target-template-render id="narrowerConcepts" template='{{>tmp}}'>
        <template id="tmp">
          <div class="narrow">
            <div class="card__title">NARROWER CONCEPTS</div>
            <semantic-table query='
              PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
              SELECT DISTINCT * WHERE {
                <{{page-resource}}> skos:narrower|^skos:broader ?concept .
                ?concept <http://www.w3.org/2004/02/skos/core#prefLabel> ?name .
              }' 
              number-of-displayed-rows="10"
              tuple-template='{{> tmp}}'
              no-result-template='No narrower concepts.'
            >
              <template id="tmp">
                <mp-event-trigger type='Component.TemplateUpdate' data='{"selectedConcept": "{{concept.value}}"}' targets='["narrowerConcepts"]'>
                  <div class='concept {{# ifCond selectedConcept "===" concept.value }}selected{{/ifCond}}'>{{name.value}}</div>
                </mp-event-trigger>
              </template>
            </semantic-table>
          </div>
          <div class="narrower">
            {{#if selectedConcept}}
              <semantic-table query='
                PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
                SELECT DISTINCT ?name WHERE {
                  <{{selectedConcept}}> skos:narrower|^skos:broader ?concept .
                  ?concept <http://www.w3.org/2004/02/skos/core#prefLabel> ?name .
                }' 
                number-of-displayed-rows="10"
                options='{"showFilter":false}'
                tuple-template='{{> tmp}}'
              >
                <template id="tmp">
                  <div class="concept">{{name.value}}</div>
                </template>
              </semantic-table>
            {{/if}}
          </div>
      </template>
    </mp-event-target-template-render>
  </div>
  <div class="row related-concepts">
    <div class="card__title">RELATED CONCEPTS</div>
    <div>
      <semantic-query query='
        SELECT ?relatedConcept WHERE {
          BIND(<{{page-resource}}> as ?concept)
          ?concept <http://www.w3.org/2004/02/skos/core#related> ?relatedConcept .
        }
      ' template='{{>tmp}}'>
        <template id="tmp">
          {{#each bindings}}
            <div class="chip">
              <semantic-link class="chip__name" iri="{{relatedConcept.value}}"></semantic-link>
              <div class="chip__icon"></div>
            </div>
          {{/each}}
        </template>
      </semantic-query>
    </div>
  </div>
  <div class="row card publications">
    <mp-event-target-template-render id="publications" template='{{>tmp}}'>
      <template id="tmp">
        <div class="publications__header">
          <div class="card__title">PUBLICATIONS</div>
          <div class="buttons">
            <mp-event-trigger type='Component.TemplateUpdate' data='{"sort":"DESC (?cited)", "all": "{{all}}"}' targets='["publications"]'>
              <button class='{{#unless sort}}selected{{/unless}}{{#ifCond sort "===" "DESC (?cited)"}}selected{{/ifCond}}'>Most cited</button>
            </mp-event-trigger>
            <mp-event-trigger type='Component.TemplateUpdate' data='{"sort":"DESC (?publicationYear)", "all": "{{all}}"}' targets='["publications"]'>
              <button class='{{#ifCond sort "===" "DESC (?publicationYear)"}}selected{{/ifCond}}'>Latest</button>
            </mp-event-trigger>
          </div>
        </div>
        <semantic-table query='
          SELECT ?title ?publication ?cited ?publicationYear ?publisher ?volume ?issue (group_concat(DISTINCT ?name; separator = ", ") as ?authors) (COUNT(?publication) as ?count) WHERE {
            {
              SELECT * WHERE {
                ?publication <https://semopenalex.org/property/hasConcept> <{{page-resource}}> .  
              }
              LIMIT 1001
            }
            ?publication <http://purl.org/dc/terms/creator> ?author . 
            ?publication <http://purl.org/dc/terms/title> ?title .
            ?author <http://xmlns.com/foaf/0.1/name> ?name .
            ?publication <https://semopenalex.org/property/citedByCount> ?cited .
            OPTIONAL {
              ?publication <https://semopenalex.org/property/hasHostVenue> ?hostVenue .
              ?hostVenue <https://semopenalex.org/property/hasVenue> ?venue .
              ?venue <http://purl.org/dc/terms/publisher> ?publisher .
            }
            OPTIONAL {
              ?publication <https://semopenalex.org/property/hasVolume> ?volume .
            }
            OPTIONAL {
              ?publication <https://semopenalex.org/property/hasIssue> ?issue .
            }
            OPTIONAL {
              ?publication <http://purl.org/spar/fabio/hasPublicationYear> ?publicationYear .  
            }
          } 
          GROUP BY ?title ?publication ?publicationYear ?cited ?publisher ?volume ?issue
          ORDER BY {{#if sort}}{{sort}}{{else}}DESC(?cited){{/if}}
          LIMIT {{#ifCond all "===" "true"}}1001{{else}}10{{/ifCond}}' 
          number-of-displayed-rows="10"
          tuple-template='
            <div class="publication">
              <div class="publication__top">
                <semantic-link iri="{{publication.value}}">
                  <div class="publication__title">{{title.value}}</div>
                </semantic-link>
                <div class="publication__author" style="width: 100%;">
                  <mp-text-truncate truncate="..." style="width: inherit;">
                    By {{authors.value}}
                  </mp-text-truncate>
                </div>
                <div class="publication__info">
                  {{#if publisher}}{{publisher.value}}, {{/if}}
                  {{#if volume}}Volume {{volume.value}}, {{/if}}
                  {{#if issue}}Issue {{issue.value}}, {{/if}}
                  {{publicationYear.value}}
                </div>
              </div>
              <div class="publication__bottom">
                <div class="publication__year">{{publicationYear.value}}</div>
                <div class="publication__citation">
                  <div class="publication__citation-icon"></div>
                  <div class="publication__citation-value">{{cited.value}}</div>
                </div>
              </div>
            </div>
        ' options='{"showFilter":false}'></semantic-table>
        <mp-event-trigger type='Component.TemplateUpdate' data='{"all": "true", "sort": "{{sort}}"}' targets='["publications"]'>
          <button class='publications__foot-button {{#ifCond all "===" "true"}}publications__foot-button--disabled{{/ifCond}}'>ALL PUBLICATIONS</button>
        </mp-event-trigger>
        <semantic-query query='SELECT (COUNT(*) as ?count) WHERE {
          {
            SELECT * WHERE {
              ?publication <https://semopenalex.org/property/hasConcept> <{{page-resource}}> .  
            }
            LIMIT 1001
          }
        }' template='{{> tmp}}'>
          <template id="tmp">
            {{#each bindings}}
              {{#ifCond count.value ">=" 1000}}<div class="warning">The table above is a preview of 1000 publications. However, the absolute number of publications seems to be larger and some publications might be missing.</div>{{/ifCond}}
            {{/each}}
          </template>
        </semantic-query>
      </template>
    </mp-event-target-template-render>
  </div>
</div>